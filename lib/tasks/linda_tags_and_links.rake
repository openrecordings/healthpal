desc "Load Linda's tags and links for usability testing"
task linda_tags_and_links: :environment do
  id_offset = 3279
  r = Recording.find(8)
  utts = utterances.delete_if {|u| u[0].round(-3) < 4000}
  create_tags(r, utts, id_offset)
  create_links(r, utts, id_offset)
end

def create_tags(r, utts, id_offset)
  utts.each_with_index do |ut, i|
    utags = tags.find_all {|t| t[0] == id_offset + i}
    if utags
      utt = Utterance.find(id_offset + i)
      utags.each do |t|
        tag.create!(
          utterance: utterance.find(min_u_id + i),
          tag_type: tagtype.find(t[1])
        )
      end
    end
  end
end

def create_links(r, utts, id_offset)
  # the min id for utterance records in r
  min_u_id = r.utterances.select(:id).min_by {|u| u.id}.id
  # the min id in the utterances array for utts
  umin_id = utts.min_by {|u| u[0]}[0]
  utts.each_with_index do |ut, i|
    ulinks = links.find_all {|l| l[3] == umin_id + i}
    if ulinks
      utt = Utterance.find(min_u_id + i)
      ulinks.each do |l|
        Link.create!(
          utterance: Utterance.find(min_u_id + i),
          label: l[1],
          url: l[2]
        )
      end
    end
  end
end

def utterances
  # index, text, start_time, end_time],
  [
    [0  ,"How are you feeling overall?",0,2],
    [1  ,"Well, you notice when I do this -",2,3],
    [2  ,"Um-hum.",3,4],
    [3  ,"- in my foot.",4,5],
    [4  ,"Um-hum.",5,6],
    [5  ,"Then my both legs now.",6,8],
    [6  ,"Yeah.",8,9],
    [7  ,"But the pain, I can control in the back, you know, with the Norco, and ah, what is that other stuff that you gave me?",9,14],
    [8  ,"Gabapentin maybe?",14,16],
    [9  ,"No, no, no.",16,17],
    [10 ,"Or the Tramadol?",17,18],
    [11 ,"Yeah. Those 2 helped with the pain that I have from the surgery on my back but they don't help nerve.",18,22],
    [12 ,"Right.  Well, they can to a point but not -",22,25],
    [13 ,"I don't feel well on some days.",25,27],
    [14 ,"And your blood pressure is pretty high today as well.",27,30],
    [15 ,"Yeah, I know.  I wasn't feeling good today, so _____ I just ran into the shower and got down here.",30,36],
    [16 ,"Have you - At one point, we were checking blood pressure fairly irregularly, have you checked it on the past -",36,42],
    [17 ,"I haven't.",42,43],
    [18 ,"Month or so?",43,44],
    [19 ,"No.",44,45],
    [20 ,"So, just _____ if you could maybe just check it once or twice sometime.",45,49],
    [21 ,"Okay.",49,50],
    [22 ,"Between now and the end of the month.  And if it is up for some reason, then give us a call.",50,54],
    [23 ,"Okay.",54,56],
    [24 ,"So, you check blood pressure at home a few times and call if - because we kinda had the same thing before where you come in here, it's pretty high and then you checked it at home, and we checked your machine and it was pretty good.  So, whatever numbers you get will be -",56,72],
    [25 ,"Yeah, its, its, I know, -",72,74],
    [26 ,"Not just today.",74,75],
    [27 ,"- I'll be high today.",75,76],
    [28 ,"Yeah.",76,77],
    [29 ,"Yeah, because I was trying to handle a lot of things this morning.",77,80],
    [30 ,"Sleep-wise, how have you been doing these days?",80,82],
    [31 ,"Well, I was doing very good until this hour change, My God.",82,86],
    [32 ,"Okay, well then, we were to, just the rest _____ .",86,89],
    [33 ,"I mean, it never bothered me before when they do that.  Then all of the sudden, I don't know _____ what day it is.",89,95],
    [34 ,"That's okay.  You don't need to be asked.",95,98],
    [35 ,"So, pain-wise, remember before -",98,100],
    [36 ,"Itâ€™s painful.",100,101],
    [37 ,"Yeah.  Before you were on the gabapentin that we had used for the shingles pain, remember when you had all that herpes shingles last year?  That is a nerve pain controller drug and that's what it was designed for.",101,112],
    [38 ,"What was this called?",112,114],
    [39 ,"The gabapentin, Neurontin.  It's not really strong but -",114,118],
    [40 ,"No.",118,120],
    [41 ,"- it is what it is.  Its kind of - it's probably the best one out there for this.",120,124],
    [42 ,"There is a reason, one of the reasons I quit gabapentin was because I put on weight.  I mean, immediately I start gaining and I have never liked it.  Its not",124,132],
    [43 ,"Ahhh, so -",132,133],
    [44 ,"And I don't try anything.",133,135],
    [45 ,"Yeah.  It was probably because you don't bruise much as you used to be -",135,139],
    [46 ,"That's true.",139,140],
    [47 ,"But isn't that about.  There's not really any that are going to be likely to make much of the difference.",140,147],
    [48 ,"Okay.",147,149],
    [49 ,"That wouldn't have - although, the gabapentin for most people who tend to be weight gainer, yeah, it's a very common rather to most people.",149,156],
    [50 ,"_____ like it didn't make no difference but it didn't affect this way.",156,160],
    [51 ,"Right, and mostly, I mean, there are so many people who had gabapentin.  I've got, I don't know how many patients, but more than I can count who use for this, but again.",160,170],
    [52 ,"Should I try it again?  I've got -",170,173],
    [53 ,"I would try it.  Do you remember what dosages those were?  I'll tell you what I had sent in before.",173,179],
    [54 ,"No, I don't.",179,180],
    [55 ,"Probably, 300 mg, be my guest, but I'll tell you.  300 mg and I had also sent in 100 mg, but the last one I sent in were 300.  When do you notice that the foot pain is the worst?",180,192],
    [56 ,"All the time.  It never, never ceases.  It wakes me up at night.",192,196],
    [57 ,"And still the right side is worst than the other one?",196,199],
    [58 ,"Yes, both from now but it's the right-sided toe is -",199,202],
    [59 ,"With the bunion?",202,203],
    [60 ,"Yeah.  That's the one that hurts the most.",203,205],
    [61 ,"So that's -",205,206],
    [62 ,"And then the arthritis is really starting to get _____ with the, with everything I had, I mean, my fingers are twisting, you -",206,214],
    [63 ,"Um-hum.",214,215],
    [64 ,"- and they hurt.  And, there's a pain right here that, I don't know what the heck it is but if it touches, that makes it real painful.",215,221],
    [65 ,"Um-hum.",221,222],
    [66 ,"Are they arthritis?",222,224],
    [67 ,"Well, some of that is arthritis, yeah.",224,226],
    [68 ,"But, you can feel the bone.",226,228],
    [69 ,"Yeah.  Arthritis, these are the classic basis of being arthritis ____ .",228,232],
    [70 ,"How's that?",232,234],
    [71 ,"Will be through here but you get more of it -",234,237],
    [72 ,"Right here.",237,238],
    [73 ,"You get more of it here is it?",238,240],
    [74 ,"No.  Right here.  Right, right here in this area",240,243],
    [75 ,"So, that's, that's a little ganglion cyst, it's on the tendon.  So, the reason my hand closes is because I've got muscles up here that contract, closes my finger this was way, right.  So, you can almost imagine a pulley.",243,256],
    [76 ,"Um-hum.",256,258],
    [77 ,"Right.  And the reason that those pulleys don't spring up is because there's a bunch of little straps all the way down and those straps can have their own body fluid that comes.",258,266],
    [78 ,"Good.",266,268],
    [79 ,"_____  Well, in that process of being able to do that -",268,270],
    [80 ,"Um-hum.",270,271],
    [81 ,"- you can get a little cyst in those -",271,273],
    [82 ,"Oh.",273,274],
    [83 ,"_____ that is 99% probable.",274,276],
    [84 ,"Right.",276,277],
    [85 ,"Both can be removed surgically.  So, we could have, like a surgeon do that if it bothers you too much.",277,282],
    [86 ,"Um-hum.",282,283],
    [87 ,"But you don't have to.",283,284],
    [88 ,"They don't mean anything.  The doctor _____.",284,287],
    [89 ,"I know.  It's a last resort but I'm just kinda letting you know that, some things that you could do as need be but -",287,294],
    [90 ,"Yeah.",294,295],
    [91 ,"So, if it's bothering you with the things that you'd like to do, like painting or just -",295,298],
    [92 ,"That's right.",298,299],
    [93 ,"- the stuff around the house.",299,300],
    [94 ,"Um-hum.",300,301],
    [95 ,"Then, just let me know.",301,302],
    [96 ,"Okay.",302,303],
    [97 ,"It's a pretty minor procedure.  Had you seen any of the ortho that is in town like Johnson or Smith before?  Ring any bells?",303,312],
    [98 ,"Who?",312,313],
    [99 ,"Dr. Johnson or Dr. Smith, the orthopedic surgeon.",313,316],
    [100,"Oh.  I think Dr. Smith once.",316,318],
    [101,"So, he does those in the office.",318,320],
    [102,"So, we could always have you go see him again and you guys can talk about that ganglion cyst.",320,325],
    [103,"Okay.",325,327],
    [104,"That's about an easiest procedure, that is in and out of the office like, like this.  Um, let me just put it on here I guess.  That's the right hand's, the middle finger?",327,337],
    [105,"Um-hum.",337,338],
    [106,"I know what you were doing when you were a youth.",338,340],
    [107,"Oh.",340,341],
    [108,"Using that finger too often.",341,343],
    [109,"Not really.",343,344],
    [110,"That's what they all say.  You have done lot, lots of stuff, played music, had kids -",344,350],
    [111,"I bet what's why I'm -",350,351],
    [112,"_____ make art.",351,352],
    [113,"- trying things, just a few if I can do it and then, I'll move on to something else.  So, -",352,357],
    [114,"That's a good thing to do.",357,359],
    [115,"So, that's a third right flexor.  Flexor, um, probable small ganglion cyst.",359,365],
    [116,"Like what is that?",365,367],
    [117,"No one really knows.  They, they predicted some type of the trauma whether it's like a bang to it or just a slow progression.",367,375],
    [118,"I noticed it last year, last, um, summer exactly.",375,379],
    [119,"Yeah.",379,380],
    [120,"_____ go away.",380,381],
    [121,"The catching you mean, or the bump or both.",381,383],
    [122,"It was when I was writer, you know.",383,385],
    [123,"Yeah.",385,386],
    [124,"And that's how it started.",386,387],
    [125,"Well, if it's really interfering with the things that you'd like to do, I'd go see him sooner.",387,392],
    [126,"Yeah.",392,393],
    [127,"You want me to send a referral out now or do you want, ah?",393,396],
    [128,"No.",396,397],
    [129,"Okay.  All you need to do is give us a call.",397,399],
    [130,"I will.",399,401],
    [131,"So, I will say, see ortho if symptoms worsen, how does that sound?",401,404],
    [132,"Okay.",404,406],
    [133,"When do we get blood work done last?",406,408],
    [134,"Well, like few months ago.",408,410],
    [135,"Like a few months?  Or not even?",410,413],
    [136,"I think that was in the fall, wasn't it?",413,415],
    [137,"Last spring.",415,416],
    [138,"I don't even remember.",416,417],
    [139,"Yeah.  So, we will need to get lab work done, unless you had it done in the past week or something?",417,422],
    [140,"No.",422,424],
    [141,"It's been a year.",424,425],
    [142,"Is that right?",425,426],
    [143,"Yeah. So, we're not too far behind but lets get a - we will check the thyroid as well.  So, we will get some annual labs -",426,433],
    [144,"Copy.",433,434],
    [145,"Um, we had talked about other options for overall pain control, one would be, you know, going to that pain clinic in Woodstock.",434,442],
    [146,"It's almost no for me.  I can't take off and go down there.",442,446],
    [147,"Well, here's what I would do?",446,448],
    [148,"You want me to drive that far.",448,450],
    [149,"Right.  It might be worth just going in and sitting down â€¦ they are pain specialists, so they know more about pain management than I do.  If they come up with the great plans and I can continue with that.",450,460],
    [150,"Okay.",460,462],
    [151,"So, I'd like their brain.",462,463],
    [152,"Um-hum.",463,464],
    [153,"If I could steal their brain, I would just use it, but it would be good for them to sit down with you and say, here's where you are.  This is probably a better long-term solution based on who you are, how old you are and what you can get from them.  And then, unless it is something really, â€¦ that I cannot do, then they'll probably be happy and after that to do it for you anyway _____-",464,485],
    [154,"PATIENT: What's his name?",485,486],
    [155,"Peterson?",486,487],
    [156,"Yeah, yeah.",487,488],
    [157,"Yeah.",488,489],
    [158,"Yeah.",488,489],
    [159,"Dr. Peterson is a good guy.",489,491],
    [160,"Okay.",491,492],
    [161,"We could have you see Peterson.  Just to kind of maybe have a one-time go over everything and then you could decide if you want him to manage it -",492,499],
    [162,"No.",499,501],
    [163,"Or?  Okay, I mean, I'll do my best to take care of you but again, I'm only so good and I am not going to pretend.",501,508],
    [164,"Let me think on that.",508,509],
    [165,"Okay.",509,510],
    [166,"I'll think on that now.",510,512],
    [167,"I think, I think it will be good at least to sit down and say, ""Do you have a better solution than what I'm proposing"" and if he does and it sounds good to you, then I will take it over from a prescribing point of view so you don't need _____.",512,523],
    [168,"They give shots, right?",523,524],
    [169,"He can give shots.  So, I can even do those.  So, what if the shot helped?",524,530],
    [170,"No.  My fear is I don't trust them when I have to, can't give me the shot to take _____.",530,535],
    [171,"Which we can always do that but -",535,538],
    [172,"But why would I want to have some doctors do it _____ .",538,541],
    [173,"No.  Peterson is here all the time.",541,543],
    [174,"Oh!  I don't agree.",543,545],
    [175,"Yeah.  No, no.  He is a local.  So, you could have at least sit down in a brain-to-brain.",545,550],
    [176,"Um-hum.",550,551],
    [177,"You could see options and if he says, ""Well, it would be better if you did this, and then this combination of other pill types"" -",551,558],
    [178,"Yeah.",558,560],
    [179,"And then, if you thought, ""Yeah, works good"", and then, I could take it over.",560,564],
    [180,"Um-hum.",564,565],
    [181,"Ah, just an option, I mean -",565,566],
    [182,"Okay.",566,567],
    [183,"Because I want you to get out and do stuff and -",567,571],
    [184,"I'm trying.",571,572],
    [185,"- if there's somebody who can help you and do that better than I can, then, I'd say, go for it.  So, think about it in the back of your mind because there's other pain clinic in Woodstock as well that we had talked about.  Um, so, let say Peterson??  At least for a consultation as we call it.",572,589],
    [186,"I don't wanna make appointment with him _____, so that is canceled too.",589,593],
    [187,"I know it.  Well, when you're ready - So, any other questions or things we need to think about for today?",593,599],
    [188,"No, I don't have any.",599,601],
    [189,"Okay.  Do you need refills on any meds?",601,603],
    [190,"Not right now.",603,605],
    [191,"Okay.  Well, let me know if you do.",605,607],
    [192,"I probably got long enough for another month.",607,609],
    [193,"Okay.",609,610],
    [194,"I'll call you.",610,611],
    [195,"Okay.  And then, let me know, if you wouldn't mind, if your blood pressure is high at home, then please give me a call.",611,615],
    [196,"Okay.  I will.",615,617],
    [197,"And just give me a heads-up.",617,618],
    [198,"um.",618,620],
    [199,"So, the big thing I'd like to get done before now and the next time we get together would be drawing the labs.",620,624],
    [200,"Okay.",624,626],
    [201,"So, those you should do fasting like you've done before but you can drink lots of water.",626,630],
    [202,"Okay.  That's for, what, 12 hours?",630,633],
    [203,"Yeah.  That would be perfect.  all right.  Remember this we have lungs?",633,637],
    [204,"Yeah.",637,638],
    [205,"Heart sounds good.  Let me have you - when you're ready, a big deep breath in and out of your mouth.",638,644],
    [206,"[Breathing in]",644,646],
    [207,"Yes.",646,647],
    [208,"[Breathing out]",647,648],
    [209,"Yes.",648,649]
  ]
end

def tags
  # utterance_index, tag_type_id
  [
    [1  ,6],
    [7  ,2],
    [20 ,5],
    [30 ,6],
    [37 ,2],
    [75 ,3],
    [85 ,8],
    [131,5],
    [139,5],
    [145,8],
    [8  ,2],
    [10 ,2],
    [11 ,2],
    [14 ,7],
    [15 ,6],
    [22 ,5],
    [24 ,5],
    [24 ,7],
    [36 ,6],
    [37 ,3],
    [42 ,6],
    [42 ,2],
    [47 ,3],
    [49 ,3],
    [50 ,6],
    [51 ,2],
    [55 ,2],
    [55 ,6],
    [67 ,1],
    [75 ,1],
    [91 ,8],
    [102,5],
    [104,3],
    [115,1],
    [117,3],
    [118,6],
    [149,5],
    [161,8],
    [167,8],
    [177,8],
    [195,5],
    [199,5],
  ]
end

def links
  [
    ['0:09', 'Norco ', 'https://medlineplus.gov/druginfo/meds/a601006.html', 7 ],
    ['0:14', 'Gabapentin', 'https://medlineplus.gov/druginfo/meds/a694007.html', 7 ],
    ['0:17', 'Tramadol', 'https://medlineplus.gov/druginfo/meds/a695011.html', 7 ],
    ['0:27', 'high blood pressure', 'https://medlineplus.gov/highbloodpressure.html', 14 ],
    ['1:41', 'Gabapentin', 'https://medlineplus.gov/druginfo/meds/a694007.html', 37 ],
    ['1:41', 'shingles', 'https://medlineplus.gov/shingles.html', 37 ],
    ['2:04', 'Gabapentin', 'https://medlineplus.gov/druginfo/meds/a694007.html', 42 ],
    ['2:29', 'Gabapentin', 'https://medlineplus.gov/druginfo/meds/a694007.html', 47 ],
    ['2:40', 'Gabapentin', 'https://medlineplus.gov/druginfo/meds/a694007.html', 51 ],
    ['3:00', 'foot pain', 'https://medlineplus.gov/ency/article/003183.htm', 55 ],
    ['3:22', 'bunion', 'https://medlineplus.gov/ency/article/001231.htm', 55 ],
    ['3:26', 'arthritis', 'https://medlineplus.gov/arthritis.html', 55 ],
    ['3:44', 'arthritis', 'https://medlineplus.gov/arthritis.html', 67 ],
    ['4:03', 'ganglion cyst', 'https://www.assh.org/handcare/hand-arm-conditions/ganglion-cyst', 75 ],
    ['5:20', 'ganglion cyst', 'https://www.assh.org/handcare/hand-arm-conditions/ganglion-cyst', 102 ],
    ['5:59', 'ganglion cyst', 'https://www.assh.org/handcare/hand-arm-conditions/ganglion-cyst', 115 ],
    ['6:57', 'blood count test', 'https://medlineplus.gov/bloodcounttests.html', 131 ],
    ['7:14', 'pain management', 'http://www.asahq.org/whensecondscount/pain-management/', 145 ],
    ['7:30', 'pain management', 'http://www.asahq.org/whensecondscount/pain-management/', 149 ],
    ['10:11', 'blood pressure measurement', 'https://medlineplus.gov/ency/article/007490.htm', 195, ]
  ]
end
